services:
  tts-service:
    build: .
    container_name: tts-service
    ports:
      - "4000:4000"
    volumes:
      - ./outputs:/app/outputs
      - ./temp_uploads:/app/temp_uploads
      - ./voice_gallery:/app/voice_gallery
      - ./voices_db.json:/app/voices_db.json
      - ./locutores_chile:/app/locutores_chile
    environment:
      - FLASK_PORT=4000
      - FLASK_DEBUG=false
      - COQUI_TOS_AGREED=1
      - PYTHONUNBUFFERED=1
      - ALLOWED_ORIGINS=http://localhost:3004,https://ai.cloudmusic.cl
      - FLASK_SECRET_KEY=production-secret-key-tts-service-2026
      - OUTPUT_DIR=outputs
      - TEMP_DIR=temp_uploads
      - VOICES_DIR=voice_gallery
      - VOICES_DB=voices_db.json
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 16G
          cpus: '8'
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
